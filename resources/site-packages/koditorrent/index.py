import socket
from koditorrent import plugin, magnet, scrapers, socks
from koditorrent.ga import tracked
from koditorrent.utils import ensure_fanart
from koditorrent.platform import PLATFORM

otherType = str(plugin.get_setting("other"))
if otherType == "The Pirate Bay":
    from koditorrent.scrapers import \
        MODULES, \
        eztv, \
        yify, \
        tpb
elif otherType == "Kickass Torrents":
    from koditorrent.scrapers import \
        MODULES, \
        eztv, \
        yify, \
        kickass


    
if plugin.get_setting("use_socks", bool):
    socks.set_default_proxy(socks.SOCKS5, plugin.get_setting("proxy_url"), plugin.get_setting("proxy_port"), plugin.get_setting("proxy_user"), plugin.get_setting("proxy_pass"))
    socket.socket = socks.socksocket


@plugin.route("/")
@ensure_fanart
@tracked(force=True)
def index():
    if PLATFORM["os"] not in ["android", "linux", "windows", "darwin"]:
        plugin.notify("Your system \"%(os)s_%(arch)s\" is not supported." % PLATFORM, delay=15000)

    for module in MODULES:
        yield {
            "label": module["name"],
            "thumbnail": module["image"],
            "path": plugin.url_for(module["view"]),
        }
