import socket
from koditorrent import plugin, magnet, scrapers
from koditorrent.ga import tracked
from koditorrent.utils import ensure_fanart
from koditorrent.platform import PLATFORM

scrapers = []
if plugin.get_setting("display_eztv", bool):
    scrapers.append("eztv")
if plugin.get_setting("display_yify", bool):
    scrapers.append("yify")
if plugin.get_setting("display_tpb", bool):
    scrapers.append("tpb")
if plugin.get_setting("display_kat", bool):
    scrapers.append("kickass")
if plugin.get_setting("display_bitsnoop", bool):
    scrapers.append("bitsnoop")
if plugin.get_setting("display_btdigg", bool):
    scrapers.append("btdigg")
if plugin.get_setting("display_extratorrent", bool):
    scrapers.append("extratorrent")
if plugin.get_setting("display_nyaa", bool):
    scrapers.append("nyaa")
    
from koditorrent.scrapers import \
    MODULES
for scraper in scrapers:
    __import__("koditorrent.scrapers", fromlist=[scraper])

@plugin.route("/")
@ensure_fanart
@tracked(force=True)
def index():
    if PLATFORM["os"] not in ["android", "linux", "windows", "darwin"]:
        plugin.notify("Your system \"%(os)s_%(arch)s\" is not supported." % PLATFORM, delay=15000)

    for module in MODULES:
        yield {
            "label": module["name"],
            "thumbnail": module["image"],
            "path": plugin.url_for(module["view"]),
        }
